================================================================================
                    API FLOW & IMPLEMENTATION GUIDE
================================================================================

üìã TABLE OF CONTENTS
================================================================================
1. Complete SignIn API Flow Example
2. Step-by-Step Flow Breakdown
3. File-by-File Code Execution
4. Error Handling Flow
5. Success Flow with Store Updates
6. How to Implement New API Integration (Step-by-Step)

================================================================================
1. COMPLETE SIGNIN API FLOW EXAMPLE
================================================================================

üéØ SCENARIO: User clicks "Sign In" button with email and password

üì± STARTING POINT: components/credentials/SignIn.jsx
üìä ENDING POINT: User redirected to dashboard with stores initialized

üîÑ COMPLETE FLOW OVERVIEW:
User Input ‚Üí Form Validation ‚Üí Store Action ‚Üí API Call ‚Üí Response Handling ‚Üí Store Update ‚Üí UI Update ‚Üí Redirect

================================================================================
2. STEP-BY-STEP FLOW BREAKDOWN
================================================================================

STEP 1: USER INTERACTION
========================
üìç FILE: components/credentials/SignIn.jsx
üìç LINE: User clicks submit button
üìç ACTION: handleSubmit function is triggered

```javascript
const handleSubmit = async (e) => {
  e.preventDefault();
  // Form validation happens here
  // Then calls the login function
};
```

STEP 2: FORM VALIDATION
=======================
üìç FILE: components/credentials/SignIn.jsx
üìç LINES: 95-115 (form validation logic)
üìç ACTION: Client-side validation of email and password

```javascript
// Validate email format
const emailError = !formData.email.includes('@');
// Validate password length
const passwordError = formData.password.length < 6;
```

STEP 3: STORE ACTION CALL
=========================
üìç FILE: components/credentials/SignIn.jsx
üìç LINE: 120 (approximately)
üìç ACTION: Calls login function from auth store

```javascript
const result = await login({
  email: formData.email,
  password: formData.password,
  rememberMe: rememberMe,
});
```

STEP 4: STORE FUNCTION EXECUTION
================================
üìç FILE: store/common/authStore.js
üìç LINES: 15-50 (login function)
üìç ACTION: Store sets loading state and makes API call

```javascript
login: async (credentials) => {
  set({ loading: true, error: null });
  
  try {
    const response = await apiClient.post('/api/auth/login', {
      email: credentials.email,
      password: credentials.password,
    });
    // Handle response...
  } catch (error) {
    // Handle error...
  }
},
```

STEP 5: API CONFIGURATION
=========================
üìç FILE: store/common/apiConfig.js
üìç LINES: 10-15 (Axios instance creation)
üìç ACTION: Axios instance is used with pre-configured settings

```javascript
const apiClient = axios.create({
  baseURL: 'https://news-app-backend-lo3a.onrender.com',
  headers: {
    'x-authorization-token': AUTH_TOKEN,
    'Content-Type': 'application/json',
  },
  timeout: 30000,
});
```

STEP 6: REQUEST INTERCEPTOR
===========================
üìç FILE: store/common/apiConfig.js
üìç LINES: 17-28 (Request interceptor)
üìç ACTION: Adds authentication token to request headers

```javascript
apiClient.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem('authToken') || sessionStorage.getItem('authToken');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  }
);
```

STEP 7: HTTP REQUEST SENT
==========================
üìç NETWORK: HTTP POST request to backend
üìç URL: https://news-app-backend-lo3a.onrender.com/api/auth/login
üìç HEADERS: Content-Type, x-authorization-token, Authorization (if token exists)
üìç BODY: { email: "user@example.com", password: "password123" }

STEP 8: BACKEND PROCESSING
==========================
üìç LOCATION: Your backend server
üìç ACTION: Backend validates credentials and returns response
üìç SUCCESS RESPONSE: { user: {...}, token: "jwt-token" }
üìç ERROR RESPONSE: { message: "Invalid credentials" }

STEP 9: RESPONSE INTERCEPTOR
============================
üìç FILE: store/common/apiConfig.js
üìç LINES: 30-70 (Response interceptor)
üìç ACTION: Handles response or error before returning to store

```javascript
apiClient.interceptors.response.use(
  (response) => {
    console.log('‚úÖ API Response Success:', response.config.url, response.status);
    return response;
  },
  (error) => {
    // Handle 401, 403, 500, network errors
    if (error.response?.status === 401) {
      // Auto logout and redirect
    }
    return Promise.reject(new Error(userFriendlyMessage));
  }
);
```

STEP 10: STORE RESPONSE HANDLING
================================
üìç FILE: store/common/authStore.js
üìç LINES: 25-45 (success/error handling in login function)
üìç ACTION: Updates store state based on response

SUCCESS PATH:
```javascript
const { user, token } = response.data;

// Store token
if (credentials.rememberMe) {
  localStorage.setItem('authToken', token);
} else {
  sessionStorage.setItem('authToken', token);
}

// Update store state
set({
  user: userWithRole,
  isAuthenticated: true,
  loading: false,
  error: null,
});

return { success: true, user: userWithRole };
```

ERROR PATH:
```javascript
set({
  loading: false,
  error: error.message,
});
return { success: false, error: error.message };
```

STEP 11: COMPONENT RESPONSE HANDLING
====================================
üìç FILE: components/credentials/SignIn.jsx
üìç LINES: 130-150 (result handling)
üìç ACTION: Component handles the returned result

SUCCESS PATH:
```javascript
if (result.success) {
  // Clear form
  setFormData({ email: '', password: '' });
  
  // Show success notification
  showSuccessMessage(`Welcome back, ${result.user.name}!`);
  
  // Initialize stores based on user role
  await initializeStores(result.user);
  
  // Redirect to dashboard
  router.push('/');
}
```

ERROR PATH:
```javascript
else {
  showErrorMessage(result.error || 'Login failed. Please try again.');
}
```

STEP 12: STORE INITIALIZATION
=============================
üìç FILE: store/index.js
üìç LINES: 78-121 (initializeStores function)
üìç ACTION: Initializes role-specific stores based on user role

```javascript
export const initializeStores = async (user) => {
  const stores = getStoresByRole(user.role);
  
  switch (user.role) {
    case USER_TYPES.ADMIN:
      await stores.dashboard.getState().getDashboardStats();
      break;
    case USER_TYPES.EMPLOYER:
      await stores.team.getState().getTeamMembers();
      break;
    case USER_TYPES.USER:
      await stores.profile.getState().getProfile();
      await stores.tasks.getState().getYourTasks();
      break;
  }
};
```

STEP 13: UI NOTIFICATION
========================
üìç FILE: store/common/uiStore.js
üìç LINES: 50-70 (addNotification function)
üìç ACTION: Shows success notification to user

```javascript
showSuccessMessage: (message, title = 'Success') => {
  return get().addNotification({
    type: 'success',
    title,
    message,
  });
},
```

STEP 14: NAVIGATION
===================
üìç FILE: components/credentials/SignIn.jsx
üìç LINE: router.push('/')
üìç ACTION: User is redirected to dashboard page

STEP 15: DASHBOARD LOAD
=======================
üìç FILE: app/page.jsx
üìç ACTION: Dashboard loads with user authenticated and stores initialized
üìç RESULT: User sees personalized dashboard based on their role

================================================================================
3. FILE-BY-FILE CODE EXECUTION
================================================================================

üìÅ components/credentials/SignIn.jsx
‚îú‚îÄ‚îÄ handleSubmit() called
‚îú‚îÄ‚îÄ Form validation executed
‚îú‚îÄ‚îÄ login() called from auth store
‚îî‚îÄ‚îÄ Response handling and redirect

üìÅ store/common/authStore.js
‚îú‚îÄ‚îÄ login() function executed
‚îú‚îÄ‚îÄ Loading state set to true
‚îú‚îÄ‚îÄ API call made via apiClient
‚îú‚îÄ‚îÄ Response processed
‚îú‚îÄ‚îÄ Store state updated
‚îî‚îÄ‚îÄ Result returned to component

üìÅ store/common/apiConfig.js
‚îú‚îÄ‚îÄ Request interceptor adds headers
‚îú‚îÄ‚îÄ HTTP request sent to backend
‚îú‚îÄ‚îÄ Response interceptor processes response
‚îî‚îÄ‚îÄ Final response/error returned

üìÅ store/common/uiStore.js
‚îú‚îÄ‚îÄ showSuccessMessage() called
‚îú‚îÄ‚îÄ Notification added to state
‚îî‚îÄ‚îÄ Auto-dismiss timer started

üìÅ store/index.js
‚îú‚îÄ‚îÄ initializeStores() called
‚îú‚îÄ‚îÄ Role-specific stores identified
‚îú‚îÄ‚îÄ Store initialization based on role
‚îî‚îÄ‚îÄ Additional data loaded

üìÅ app/page.jsx
‚îú‚îÄ‚îÄ Component re-renders
‚îú‚îÄ‚îÄ Authentication state checked
‚îú‚îÄ‚îÄ Role-based content displayed
‚îî‚îÄ‚îÄ Dashboard fully loaded

================================================================================
4. ERROR HANDLING FLOW
================================================================================

üö® NETWORK ERROR SCENARIO:
User Input ‚Üí Store Action ‚Üí API Call ‚Üí Network Failure ‚Üí Response Interceptor ‚Üí Error Transformation ‚Üí Store Error State ‚Üí Component Error Display

üö® AUTHENTICATION ERROR SCENARIO:
User Input ‚Üí Store Action ‚Üí API Call ‚Üí 401 Response ‚Üí Response Interceptor ‚Üí Auto Logout ‚Üí Redirect to SignIn

üö® VALIDATION ERROR SCENARIO:
User Input ‚Üí Form Validation ‚Üí Error Display (No API call made)

================================================================================
5. SUCCESS FLOW WITH STORE UPDATES
================================================================================

‚úÖ COMPLETE SUCCESS FLOW:
User Input ‚Üí Validation ‚Üí API Call ‚Üí Success Response ‚Üí Token Storage ‚Üí Store Update ‚Üí Role Detection ‚Üí Store Initialization ‚Üí Notification ‚Üí Redirect ‚Üí Dashboard Load

‚úÖ STORE STATE CHANGES:
1. loading: false ‚Üí true (API call starts)
2. error: null (clear previous errors)
3. user: null ‚Üí user object (on success)
4. isAuthenticated: false ‚Üí true (on success)
5. loading: true ‚Üí false (API call complete)

‚úÖ UI STATE CHANGES:
1. Form shows loading state
2. Submit button disabled
3. Success notification appears
4. Form clears
5. Redirect to dashboard
6. Dashboard loads with user data

================================================================================
6. HOW TO IMPLEMENT NEW API INTEGRATION (STEP-BY-STEP)
================================================================================

üéØ EXAMPLE: Let's implement a "Create Task" API integration

STEP 1: IDENTIFY THE REQUIREMENTS
=================================
üìã WHAT YOU NEED TO KNOW:
- API endpoint URL (e.g., POST /api/tasks)
- Request payload structure (e.g., { name, description, assignedTo, dueDate })
- Response structure (e.g., { id, name, description, status, createdAt })
- Which user roles can access this API (admin, employer, user)
- Where in the UI this will be called (e.g., AddTaskModal component)

STEP 2: CHOOSE THE RIGHT STORE
==============================
üìÅ STORE SELECTION BASED ON USER ROLE:
- Admin functionality ‚Üí store/admin/taskStore.js
- Employer functionality ‚Üí store/employers/taskStore.js
- User functionality ‚Üí store/users/taskStore.js
- Common functionality ‚Üí store/common/ (if used by all roles)

üéØ FOR OUR EXAMPLE: We'll add to store/admin/taskStore.js

STEP 3: ADD THE API FUNCTION TO THE STORE
=========================================
üìç FILE: store/admin/taskStore.js (or appropriate store)
üìç LOCATION: Inside the create() function

```javascript
// Add this function to the store object
createTask: async (taskData) => {
  set({ loading: true, error: null });
  try {
    // Make API call using apiClient
    const response = await apiClient.post('/api/tasks', taskData);

    // Update store state with new task
    set((state) => ({
      tasks: [response.data, ...state.tasks],
      loading: false,
    }));

    // Recalculate statistics
    get().calculateStats();

    return { success: true, data: response.data };
  } catch (error) {
    set({ loading: false, error: error.message });
    console.error('Error creating task:', error);
    throw error;
  }
},
```

STEP 4: UPDATE STORE STATE STRUCTURE (IF NEEDED)
================================================
üìç FILE: Same store file
üìç ACTION: Add any new state properties needed

```javascript
// If you need new state properties, add them to the initial state
const useAdminTaskStore = create((set, get) => ({
  // Existing state...
  tasks: [],
  loading: false,
  error: null,

  // Add new state if needed
  taskCategories: [], // Example: if your API returns categories

  // Your new function here...
  createTask: async (taskData) => {
    // Implementation from Step 3
  },
}));
```

STEP 5: CREATE THE UI COMPONENT
===============================
üìç FILE: components/tasks/AddTaskModal.jsx (or appropriate component)
üìç ACTION: Create component that uses the store function

```javascript
// components/tasks/AddTaskModal.jsx
import { useState } from 'react';
import useAdminTaskStore from '@/store/admin/taskStore';
import useUIStore from '@/store/common/uiStore';

const AddTaskModal = () => {
  const { createTask, loading } = useAdminTaskStore();
  const { showSuccessMessage, showErrorMessage, closeModal } = useUIStore();

  const [formData, setFormData] = useState({
    name: '',
    description: '',
    assignedTo: '',
    dueDate: '',
  });

  const handleSubmit = async (e) => {
    e.preventDefault();

    try {
      const result = await createTask(formData);

      if (result.success) {
        showSuccessMessage('Task created successfully!');
        setFormData({ name: '', description: '', assignedTo: '', dueDate: '' });
        closeModal('addTask');
      }
    } catch (error) {
      showErrorMessage(error.message || 'Failed to create task');
    }
  };

  return (
    <form onSubmit={handleSubmit}>
      {/* Form fields here */}
      <button type="submit" disabled={loading}>
        {loading ? 'Creating...' : 'Create Task'}
      </button>
    </form>
  );
};

export default AddTaskModal;
```

STEP 6: ADD FORM VALIDATION (OPTIONAL BUT RECOMMENDED)
======================================================
üìç FILE: Same component file
üìç ACTION: Add client-side validation

```javascript
const validateForm = () => {
  const errors = {};

  if (!formData.name.trim()) {
    errors.name = 'Task name is required';
  }

  if (!formData.description.trim()) {
    errors.description = 'Description is required';
  }

  if (!formData.dueDate) {
    errors.dueDate = 'Due date is required';
  }

  return errors;
};

// In handleSubmit, before API call:
const validationErrors = validateForm();
if (Object.keys(validationErrors).length > 0) {
  setErrors(validationErrors);
  return;
}
```

STEP 7: INTEGRATE COMPONENT INTO PARENT
=======================================
üìç FILE: Parent component (e.g., app/tasks-management/page.jsx)
üìç ACTION: Import and use the new component

```javascript
// app/tasks-management/page.jsx
import AddTaskModal from '@/components/tasks/AddTaskModal';
import useUIStore from '@/store/common/uiStore';

const TaskManagement = () => {
  const { modals, openModal } = useUIStore();

  return (
    <div>
      <button onClick={() => openModal('addTask')}>
        Add New Task
      </button>

      {modals.addTask && <AddTaskModal />}
    </div>
  );
};
```

STEP 8: TEST THE INTEGRATION
============================
üìç ACTION: Test the complete flow

1. **Start development server**: npm run dev
2. **Open browser**: Navigate to your component
3. **Test form submission**: Fill form and submit
4. **Check network tab**: Verify API request is sent correctly
5. **Check console**: Look for any errors
6. **Verify store update**: Check if data appears in UI
7. **Test error scenarios**: Try invalid data, network issues

STEP 9: ADD ERROR HANDLING ENHANCEMENTS
=======================================
üìç FILE: Your store file
üìç ACTION: Add specific error handling

```javascript
createTask: async (taskData) => {
  set({ loading: true, error: null });

  try {
    // Validate required fields
    if (!taskData.name || !taskData.description) {
      throw new Error('Name and description are required');
    }

    const response = await apiClient.post('/api/tasks', taskData);

    // Handle different response structures
    const newTask = response.data.task || response.data;

    set((state) => ({
      tasks: [newTask, ...state.tasks],
      loading: false,
    }));

    return { success: true, data: newTask };
  } catch (error) {
    // Enhanced error handling
    let errorMessage = 'Failed to create task';

    if (error.response?.status === 400) {
      errorMessage = 'Invalid task data provided';
    } else if (error.response?.status === 403) {
      errorMessage = 'You do not have permission to create tasks';
    } else if (error.message) {
      errorMessage = error.message;
    }

    set({ loading: false, error: errorMessage });
    throw new Error(errorMessage);
  }
},
```

STEP 10: ADD LOADING STATES TO UI
=================================
üìç FILE: Your component file
üìç ACTION: Show loading indicators

```javascript
return (
  <form onSubmit={handleSubmit}>
    {loading && <div className="loading-overlay">Creating task...</div>}

    <input
      type="text"
      value={formData.name}
      onChange={(e) => setFormData({...formData, name: e.target.value})}
      disabled={loading}
      placeholder="Task name"
    />

    <button type="submit" disabled={loading}>
      {loading ? (
        <>
          <span className="spinner"></span>
          Creating...
        </>
      ) : (
        'Create Task'
      )}
    </button>
  </form>
);
```

STEP 11: UPDATE STORE EXPORTS (IF NEEDED)
=========================================
üìç FILE: store/index.js
üìç ACTION: Make sure your store is exported

```javascript
// If you created a new store file, add it to exports
export { default as useNewFeatureStore } from './path/to/newFeatureStore';

// If you added to existing store, no changes needed
```

STEP 12: ADD TYPESCRIPT TYPES (OPTIONAL)
========================================
üìç FILE: types/api.ts (if using TypeScript)
üìç ACTION: Define types for better development experience

```typescript
export interface CreateTaskRequest {
  name: string;
  description: string;
  assignedTo?: string;
  dueDate: string;
  priority?: 'low' | 'medium' | 'high';
}

export interface TaskResponse {
  id: string;
  name: string;
  description: string;
  status: 'pending' | 'in progress' | 'completed';
  createdAt: string;
  updatedAt: string;
}
```

================================================================================
                              SUMMARY CHECKLIST
================================================================================

‚úÖ BEFORE YOU START:
‚ñ° Identify API endpoint and data structure
‚ñ° Determine which store to use based on user role
‚ñ° Plan the UI component structure

‚úÖ IMPLEMENTATION STEPS:
‚ñ° Add API function to appropriate store
‚ñ° Update store state if needed
‚ñ° Create UI component with form
‚ñ° Add form validation
‚ñ° Integrate component into parent
‚ñ° Test the complete flow
‚ñ° Add error handling
‚ñ° Add loading states
‚ñ° Update exports if needed

‚úÖ TESTING CHECKLIST:
‚ñ° API request sent correctly
‚ñ° Store state updates properly
‚ñ° UI shows loading states
‚ñ° Success notifications work
‚ñ° Error handling works
‚ñ° Form validation works
‚ñ° Component integrates properly

üéØ FOLLOW THIS PATTERN FOR ANY NEW API INTEGRATION!

This guide provides a complete template for implementing any new API integration
in your application. Simply replace the task creation example with your specific
API requirements and follow the same pattern.

Happy coding! üöÄ‚ú®
